kind: job
metadata:
  name: onnx-utils
  tag: ''
  hash: a66a04301b14c1bf3c69b2090f8664315a871253
  project: default
  labels:
    author: guyl
  categories:
  - Utilities
spec:
  command: ''
  args: []
  image: mlrun/ml-models
  env: []
  default_handler: to_onnx
  entry_points:
    tf_keras_to_onnx:
      name: tf_keras_to_onnx
      doc: Convert a TF.Keras model to an ONNX model and log it back to MLRun as a
        new model object.
      parameters:
      - name: model_handler
        doc: An initialized TFKerasModelHandler with a loaded model to convert to
          ONNX.
        default: ''
      - name: onnx_model_name
        type: str
        doc: The name to use to log the converted ONNX model. If not given, the given
          `model_name` will be used with an additional suffix `_onnx`. Defaulted to
          None.
        default: null
      - name: optimize_model
        type: bool
        doc: Whether or not to optimize the ONNX model using 'onnxoptimizer' before
          saving the model. Defaulted to True.
        default: true
      - name: input_signature
        type: List[Tuple[Tuple[int], str]]
        doc: 'A list of the input layers shape and data type properties. Expected
          to receive a list where each element is an input layer tuple. An input layer
          tuple is a tuple of: [0] = Layer''s shape, a tuple of integers. [1] = Layer''s
          data type, a mlrun.data_types.ValueType string. If None, the input signature
          will be tried to be read from the model artifact. Defaulted to None.'
        default: null
      outputs:
      - default: ''
      lineno: 12
    pytorch_to_onnx:
      name: pytorch_to_onnx
      doc: Convert a PyTorch model to an ONNX model and log it back to MLRun as a
        new model object.
      parameters:
      - name: model_handler
        doc: An initialized PyTorchModelHandler with a loaded model to convert to
          ONNX.
        default: ''
      - name: onnx_model_name
        type: str
        doc: The name to use to log the converted ONNX model. If not given, the given
          `model_name` will be used with an additional suffix `_onnx`. Defaulted to
          None.
        default: null
      - name: optimize_model
        type: bool
        doc: Whether or not to optimize the ONNX model using 'onnxoptimizer' before
          saving the model. Defaulted to True.
        default: true
      - name: input_signature
        type: List[Tuple[Tuple[int], str]]
        doc: 'A list of the input layers shape and data type properties. Expected
          to receive a list where each element is an input layer tuple. An input layer
          tuple is a tuple of: [0] = Layer''s shape, a tuple of integers. [1] = Layer''s
          data type, a mlrun.data_types.ValueType string. If None, the input signature
          will be tried to be read from the model artifact. Defaulted to None.'
        default: null
      - name: input_layers_names
        type: List[str]
        doc: List of names to assign to the input nodes of the graph in order. All
          of the other parameters (inner layers) can be set as well by passing additional
          names in the list. The order is by the order of the parameters in the model.
        default: null
      - name: output_layers_names
        type: List[str]
        doc: List of names to assign to the output nodes of the graph in order.
        default: null
      outputs:
      - default: ''
      lineno: 66
    to_onnx:
      name: to_onnx
      doc: Convert the given model to an ONNX model.
      parameters:
      - name: context
        type: MLClientCtx
        doc: The MLRun function execution context
        default: ''
      - name: model_path
        type: str
        doc: The model path store object.
        default: ''
      - name: onnx_model_name
        type: str
        doc: The name to use to log the converted ONNX model. If not given, the given
          `model_name` will be used with an additional suffix `_onnx`. Defaulted to
          None.
        default: null
      - name: optimize_model
        type: bool
        doc: Whether to optimize the ONNX model using 'onnxoptimizer' before saving
          the model. Defaulted to True.
        default: true
      - name: framework_kwargs
        type: Dict[str, Any]
        doc: Additional arguments each framework may require in order to convert to
          ONNX. To get the doc string of the desired framework onnx conversion function,
          pass "help".
        default: null
      outputs:
      - default: ''
      lineno: 127
    optimize:
      name: optimize
      doc: Optimize the given ONNX model.
      parameters:
      - name: context
        type: MLClientCtx
        doc: The MLRun function execution context.
        default: ''
      - name: model_path
        type: str
        doc: Path to the ONNX model object.
        default: ''
      - name: optimizations
        type: List[str]
        doc: List of possible optimizations. To see what optimizations are available,
          pass "help". If None, all of the optimizations will be used. Defaulted to
          None.
        default: null
      - name: fixed_point
        type: bool
        doc: Optimize the weights using fixed point. Defaulted to False.
        default: false
      - name: optimized_model_name
        type: str
        doc: The name of the optimized model. If None, the original model will be
          overridden. Defaulted to None.
        default: null
      outputs:
      - default: ''
      lineno: 186
  description: ONNX intigration in MLRun, some utils functions for the ONNX framework,
    optimizing and converting models from different framework to ONNX using MLRun.
  build:
    functionSourceCode: ZnJvbSB0eXBpbmcgaW1wb3J0IEFueSwgQ2FsbGFibGUsIERpY3QsIExpc3QsIFR1cGxlCgppbXBvcnQgbWxydW4KCgpjbGFzcyBfVG9PTk5YQ29udmVyc2lvbnM6CiAgICAiIiIKICAgIEFuIE9OTlggY29udmVyc2lvbiBmdW5jdGlvbnMgbGlicmFyeSBjbGFzcy4KICAgICIiIgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiB0Zl9rZXJhc190b19vbm54KAogICAgICAgIG1vZGVsX2hhbmRsZXIsCiAgICAgICAgb25ueF9tb2RlbF9uYW1lOiBzdHIgPSBOb25lLAogICAgICAgIG9wdGltaXplX21vZGVsOiBib29sID0gVHJ1ZSwKICAgICAgICBpbnB1dF9zaWduYXR1cmU6IExpc3RbVHVwbGVbVHVwbGVbaW50XSwgc3RyXV0gPSBOb25lLAogICAgKToKICAgICAgICAiIiIKICAgICAgICBDb252ZXJ0IGEgVEYuS2VyYXMgbW9kZWwgdG8gYW4gT05OWCBtb2RlbCBhbmQgbG9nIGl0IGJhY2sgdG8gTUxSdW4gYXMgYSBuZXcgbW9kZWwgb2JqZWN0LgoKICAgICAgICA6cGFyYW0gbW9kZWxfaGFuZGxlcjogICBBbiBpbml0aWFsaXplZCBURktlcmFzTW9kZWxIYW5kbGVyIHdpdGggYSBsb2FkZWQgbW9kZWwgdG8gY29udmVydCB0byBPTk5YLgogICAgICAgIDpwYXJhbSBvbm54X21vZGVsX25hbWU6IFRoZSBuYW1lIHRvIHVzZSB0byBsb2cgdGhlIGNvbnZlcnRlZCBPTk5YIG1vZGVsLiBJZiBub3QgZ2l2ZW4sIHRoZSBnaXZlbiBgbW9kZWxfbmFtZWAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWxsIGJlIHVzZWQgd2l0aCBhbiBhZGRpdGlvbmFsIHN1ZmZpeCBgX29ubnhgLiBEZWZhdWx0ZWQgdG8gTm9uZS4KICAgICAgICA6cGFyYW0gb3B0aW1pemVfbW9kZWw6ICBXaGV0aGVyIG9yIG5vdCB0byBvcHRpbWl6ZSB0aGUgT05OWCBtb2RlbCB1c2luZyAnb25ueG9wdGltaXplcicgYmVmb3JlIHNhdmluZyB0aGUgbW9kZWwuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdGVkIHRvIFRydWUuCiAgICAgICAgOnBhcmFtIGlucHV0X3NpZ25hdHVyZTogQSBsaXN0IG9mIHRoZSBpbnB1dCBsYXllcnMgc2hhcGUgYW5kIGRhdGEgdHlwZSBwcm9wZXJ0aWVzLiBFeHBlY3RlZCB0byByZWNlaXZlIGEgbGlzdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlIGVhY2ggZWxlbWVudCBpcyBhbiBpbnB1dCBsYXllciB0dXBsZS4gQW4gaW5wdXQgbGF5ZXIgdHVwbGUgaXMgYSB0dXBsZSBvZjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMF0gPSBMYXllcidzIHNoYXBlLCBhIHR1cGxlIG9mIGludGVnZXJzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsxXSA9IExheWVyJ3MgZGF0YSB0eXBlLCBhIG1scnVuLmRhdGFfdHlwZXMuVmFsdWVUeXBlIHN0cmluZy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJZiBOb25lLCB0aGUgaW5wdXQgc2lnbmF0dXJlIHdpbGwgYmUgdHJpZWQgdG8gYmUgcmVhZCBmcm9tIHRoZSBtb2RlbCBhcnRpZmFjdC4gRGVmYXVsdGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8gTm9uZS4KICAgICAgICAiIiIKICAgICAgICAjIEltcG9ydCB0aGUgZnJhbWV3b3JrIGFuZCBoYW5kbGVyOgogICAgICAgIGltcG9ydCB0ZW5zb3JmbG93IGFzIHRmCgogICAgICAgICMgQ2hlY2sgdGhlIGdpdmVuICdpbnB1dF9zaWduYXR1cmUnIHBhcmFtZXRlcjoKICAgICAgICBpZiBpbnB1dF9zaWduYXR1cmUgaXMgTm9uZToKICAgICAgICAgICAgIyBSZWFkIHRoZSBpbnB1dHMgZnJvbSB0aGUgbW9kZWw6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG1vZGVsX2hhbmRsZXIucmVhZF9pbnB1dHNfZnJvbV9tb2RlbCgpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXJyb3I6CiAgICAgICAgICAgICAgICByYWlzZSBtbHJ1bi5lcnJvcnMuTUxSdW5SdW50aW1lRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgZiJQbGVhc2UgcHJvdmlkZSB0aGUgJ2lucHV0X3NpZ25hdHVyZScgcGFyYW1ldGVyLiBUaGUgZnVuY3Rpb24gdHJpZWQgcmVhZGluZyB0aGUgaW5wdXQgbGF5ZXJzICIKICAgICAgICAgICAgICAgICAgICBmImluZm9ybWF0aW9uIGF1dG9tYXRpY2FsbHkgYnV0IGZhaWxlZCB3aXRoIHRoZSBmb2xsb3dpbmcgZXJyb3I6IHtlcnJvcn0iCiAgICAgICAgICAgICAgICApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBQYXJzZSB0aGUgJ2lucHV0X3NpZ25hdHVyZScgcGFyYW1ldGVyOgogICAgICAgICAgICBpbnB1dF9zaWduYXR1cmUgPSBbCiAgICAgICAgICAgICAgICB0Zi5UZW5zb3JTcGVjKAogICAgICAgICAgICAgICAgICAgIHNoYXBlPXNoYXBlLAogICAgICAgICAgICAgICAgICAgIGR0eXBlPW1vZGVsX2hhbmRsZXIuY29udmVydF92YWx1ZV90eXBlX3RvX3RmX2R0eXBlKAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZV90eXBlPXZhbHVlX3R5cGUKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZm9yIChzaGFwZSwgdmFsdWVfdHlwZSkgaW4gaW5wdXRfc2lnbmF0dXJlCiAgICAgICAgICAgIF0KCiAgICAgICAgIyBDb252ZXJ0IHRvIE9OTlg6CiAgICAgICAgbW9kZWxfaGFuZGxlci50b19vbm54KAogICAgICAgICAgICBtb2RlbF9uYW1lPW9ubnhfbW9kZWxfbmFtZSwKICAgICAgICAgICAgaW5wdXRfc2lnbmF0dXJlPWlucHV0X3NpZ25hdHVyZSwKICAgICAgICAgICAgb3B0aW1pemU9b3B0aW1pemVfbW9kZWwsCiAgICAgICAgKQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBweXRvcmNoX3RvX29ubngoCiAgICAgICAgbW9kZWxfaGFuZGxlciwKICAgICAgICBvbm54X21vZGVsX25hbWU6IHN0ciA9IE5vbmUsCiAgICAgICAgb3B0aW1pemVfbW9kZWw6IGJvb2wgPSBUcnVlLAogICAgICAgIGlucHV0X3NpZ25hdHVyZTogTGlzdFtUdXBsZVtUdXBsZVtpbnRdLCBzdHJdXSA9IE5vbmUsCiAgICAgICAgaW5wdXRfbGF5ZXJzX25hbWVzOiBMaXN0W3N0cl0gPSBOb25lLAogICAgICAgIG91dHB1dF9sYXllcnNfbmFtZXM6IExpc3Rbc3RyXSA9IE5vbmUsCiAgICApOgogICAgICAgICIiIgogICAgICAgIENvbnZlcnQgYSBQeVRvcmNoIG1vZGVsIHRvIGFuIE9OTlggbW9kZWwgYW5kIGxvZyBpdCBiYWNrIHRvIE1MUnVuIGFzIGEgbmV3IG1vZGVsIG9iamVjdC4KCiAgICAgICAgOnBhcmFtIG1vZGVsX2hhbmRsZXI6ICAgICAgIEFuIGluaXRpYWxpemVkIFB5VG9yY2hNb2RlbEhhbmRsZXIgd2l0aCBhIGxvYWRlZCBtb2RlbCB0byBjb252ZXJ0IHRvIE9OTlguCiAgICAgICAgOnBhcmFtIG9ubnhfbW9kZWxfbmFtZTogICAgIFRoZSBuYW1lIHRvIHVzZSB0byBsb2cgdGhlIGNvbnZlcnRlZCBPTk5YIG1vZGVsLiBJZiBub3QgZ2l2ZW4sIHRoZSBnaXZlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgbW9kZWxfbmFtZWAgd2lsbCBiZSB1c2VkIHdpdGggYW4gYWRkaXRpb25hbCBzdWZmaXggYF9vbm54YC4gRGVmYXVsdGVkIHRvIE5vbmUuCiAgICAgICAgOnBhcmFtIG9wdGltaXplX21vZGVsOiAgICAgIFdoZXRoZXIgb3Igbm90IHRvIG9wdGltaXplIHRoZSBPTk5YIG1vZGVsIHVzaW5nICdvbm54b3B0aW1pemVyJyBiZWZvcmUgc2F2aW5nIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC4gRGVmYXVsdGVkIHRvIFRydWUuCiAgICAgICAgOnBhcmFtIGlucHV0X3NpZ25hdHVyZTogICAgIEEgbGlzdCBvZiB0aGUgaW5wdXQgbGF5ZXJzIHNoYXBlIGFuZCBkYXRhIHR5cGUgcHJvcGVydGllcy4gRXhwZWN0ZWQgdG8gcmVjZWl2ZSBhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Qgd2hlcmUgZWFjaCBlbGVtZW50IGlzIGFuIGlucHV0IGxheWVyIHR1cGxlLiBBbiBpbnB1dCBsYXllciB0dXBsZSBpcyBhIHR1cGxlIG9mOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMF0gPSBMYXllcidzIHNoYXBlLCBhIHR1cGxlIG9mIGludGVnZXJzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMV0gPSBMYXllcidzIGRhdGEgdHlwZSwgYSBtbHJ1bi5kYXRhX3R5cGVzLlZhbHVlVHlwZSBzdHJpbmcuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIE5vbmUsIHRoZSBpbnB1dCBzaWduYXR1cmUgd2lsbCBiZSB0cmllZCB0byBiZSByZWFkIGZyb20gdGhlIG1vZGVsIGFydGlmYWN0LgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0ZWQgdG8gTm9uZS4KICAgICAgICA6cGFyYW0gaW5wdXRfbGF5ZXJzX25hbWVzOiAgTGlzdCBvZiBuYW1lcyB0byBhc3NpZ24gdG8gdGhlIGlucHV0IG5vZGVzIG9mIHRoZSBncmFwaCBpbiBvcmRlci4gQWxsIG9mIHRoZSBvdGhlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzIChpbm5lciBsYXllcnMpIGNhbiBiZSBzZXQgYXMgd2VsbCBieSBwYXNzaW5nIGFkZGl0aW9uYWwgbmFtZXMgaW4gdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QuIFRoZSBvcmRlciBpcyBieSB0aGUgb3JkZXIgb2YgdGhlIHBhcmFtZXRlcnMgaW4gdGhlIG1vZGVsLgogICAgICAgIDpwYXJhbSBvdXRwdXRfbGF5ZXJzX25hbWVzOiBMaXN0IG9mIG5hbWVzIHRvIGFzc2lnbiB0byB0aGUgb3V0cHV0IG5vZGVzIG9mIHRoZSBncmFwaCBpbiBvcmRlci4KICAgICAgICAiIiIKICAgICAgICAjIEltcG9ydCB0aGUgZnJhbWV3b3JrIGFuZCBoYW5kbGVyOgogICAgICAgIGltcG9ydCB0b3JjaAoKICAgICAgICAjIFBhcnNlIHRoZSAnaW5wdXRfc2lnbmF0dXJlJyBwYXJhbWV0ZXI6CiAgICAgICAgaWYgaW5wdXRfc2lnbmF0dXJlIGlzIG5vdCBOb25lOgogICAgICAgICAgICBpbnB1dF9zaWduYXR1cmUgPSB0b3JjaC5zdGFjaygKICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICB0b3JjaC56ZXJvcygKICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZT1zaGFwZSwKICAgICAgICAgICAgICAgICAgICAgICAgZHR5cGU9bW9kZWxfaGFuZGxlci5jb252ZXJ0X3ZhbHVlX3R5cGVfdG9fdG9yY2hfZHR5cGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZV90eXBlPXZhbHVlX3R5cGUKICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgZm9yIChzaGFwZSwgdmFsdWVfdHlwZSkgaW4gaW5wdXRfc2lnbmF0dXJlCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICkKCiAgICAgICAgIyBDb252ZXJ0IHRvIE9OTlg6CiAgICAgICAgbW9kZWxfaGFuZGxlci50b19vbm54KAogICAgICAgICAgICBtb2RlbF9uYW1lPW9ubnhfbW9kZWxfbmFtZSwKICAgICAgICAgICAgaW5wdXRfc2FtcGxlPWlucHV0X3NpZ25hdHVyZSwKICAgICAgICAgICAgb3B0aW1pemU9b3B0aW1pemVfbW9kZWwsCiAgICAgICAgICAgIGlucHV0X2xheWVyc19uYW1lcz1pbnB1dF9sYXllcnNfbmFtZXMsCiAgICAgICAgICAgIG91dHB1dF9sYXllcnNfbmFtZXM9b3V0cHV0X2xheWVyc19uYW1lcywKICAgICAgICApCgoKIyBNYXAgZm9yIGdldHRpbmcgdGhlIGNvbnZlcnNpb24gZnVuY3Rpb24gYWNjb3JkaW5nIHRvIHRoZSBwcm92aWRlZCBmcmFtZXdvcms6Cl9DT05WRVJTSU9OX01BUCA9IHsKICAgICJ0Zi5rZXJhcyI6IF9Ub09OTlhDb252ZXJzaW9ucy50Zl9rZXJhc190b19vbm54LAogICAgInB5dG9yY2giOiBfVG9PTk5YQ29udmVyc2lvbnMucHl0b3JjaF90b19vbm54LAp9ICAjIHR5cGU6IERpY3Rbc3RyLCBDYWxsYWJsZV0KCgpkZWYgdG9fb25ueCgKICAgIGNvbnRleHQ6IG1scnVuLk1MQ2xpZW50Q3R4LAogICAgbW9kZWxfcGF0aDogc3RyLAogICAgb25ueF9tb2RlbF9uYW1lOiBzdHIgPSBOb25lLAogICAgb3B0aW1pemVfbW9kZWw6IGJvb2wgPSBUcnVlLAogICAgZnJhbWV3b3JrX2t3YXJnczogRGljdFtzdHIsIEFueV0gPSBOb25lLAopOgogICAgIiIiCiAgICBDb252ZXJ0IHRoZSBnaXZlbiBtb2RlbCB0byBhbiBPTk5YIG1vZGVsLgoKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgICBUaGUgTUxSdW4gZnVuY3Rpb24gZXhlY3V0aW9uIGNvbnRleHQKICAgIDpwYXJhbSBtb2RlbF9wYXRoOiAgICAgICBUaGUgbW9kZWwgcGF0aCBzdG9yZSBvYmplY3QuCiAgICA6cGFyYW0gb25ueF9tb2RlbF9uYW1lOiAgVGhlIG5hbWUgdG8gdXNlIHRvIGxvZyB0aGUgY29udmVydGVkIE9OTlggbW9kZWwuIElmIG5vdCBnaXZlbiwgdGhlIGdpdmVuIGBtb2RlbF9uYW1lYCB3aWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmUgdXNlZCB3aXRoIGFuIGFkZGl0aW9uYWwgc3VmZml4IGBfb25ueGAuIERlZmF1bHRlZCB0byBOb25lLgogICAgOnBhcmFtIG9wdGltaXplX21vZGVsOiAgIFdoZXRoZXIgdG8gb3B0aW1pemUgdGhlIE9OTlggbW9kZWwgdXNpbmcgJ29ubnhvcHRpbWl6ZXInIGJlZm9yZSBzYXZpbmcgdGhlIG1vZGVsLiBEZWZhdWx0ZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0byBUcnVlLgogICAgOnBhcmFtIGZyYW1ld29ya19rd2FyZ3M6IEFkZGl0aW9uYWwgYXJndW1lbnRzIGVhY2ggZnJhbWV3b3JrIG1heSByZXF1aXJlIGluIG9yZGVyIHRvIGNvbnZlcnQgdG8gT05OWC4gVG8gZ2V0IHRoZSBkb2MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgb2YgdGhlIGRlc2lyZWQgZnJhbWV3b3JrIG9ubnggY29udmVyc2lvbiBmdW5jdGlvbiwgcGFzcyAiaGVscCIuCiAgICAiIiIKICAgIGZyb20gbWxydW4uZnJhbWV3b3Jrcy5hdXRvX21scnVuLmF1dG9fbWxydW4gaW1wb3J0IEF1dG9NTFJ1bgoKICAgICMgR2V0IGEgbW9kZWwgaGFuZGxlciBvZiB0aGUgcmVxdWlyZWQgZnJhbWV3b3JrOgogICAgbW9kZWxfaGFuZGxlciA9IEF1dG9NTFJ1bi5sb2FkX21vZGVsKG1vZGVsX3BhdGg9bW9kZWxfcGF0aCwgY29udGV4dD1jb250ZXh0KQoKICAgICMgR2V0IHRoZSBtb2RlbCdzIGZyYW1ld29yazoKICAgIGZyYW1ld29yayA9IG1vZGVsX2hhbmRsZXIuRlJBTUVXT1JLX05BTUUKCiAgICAjIFVzZSB0aGUgY29udmVyc2lvbiBtYXAgdG8gZ2V0IHRoZSBzcGVjaWZpYyBmcmFtZXdvcmsgdG8gb25ueCBjb252ZXJzaW9uOgogICAgaWYgZnJhbWV3b3JrIG5vdCBpbiBfQ09OVkVSU0lPTl9NQVA6CiAgICAgICAgcmFpc2UgbWxydW4uZXJyb3JzLk1MUnVuSW52YWxpZEFyZ3VtZW50RXJyb3IoCiAgICAgICAgICAgIGYiVGhlIGZvbGxvd2luZyBmcmFtZXdvcms6ICd7ZnJhbWV3b3JrfScsIGhhcyBubyBPTk5YIGNvbnZlcnNpb24uIgogICAgICAgICkKICAgIGNvbnZlcnNpb25fZnVuY3Rpb24gPSBfQ09OVkVSU0lPTl9NQVBbZnJhbWV3b3JrXQoKICAgICMgQ2hlY2sgaWYgbmVlZGVkIHRvIHByaW50IHRoZSBmdW5jdGlvbidzIGRvYyBzdHJpbmcgKCJoZWxwIiBpcyBwYXNzZWQpOgogICAgaWYgZnJhbWV3b3JrX2t3YXJncyA9PSAiaGVscCI6CiAgICAgICAgcHJpbnQoY29udmVyc2lvbl9mdW5jdGlvbi5fX2RvY19fKQogICAgICAgIHJldHVybgoKICAgICMgU2V0IHRoZSBkZWZhdWx0IGVtcHR5IGZyYW1ld29yayBrd2FyZ3MgaWYgbmVlZGVkOgogICAgaWYgZnJhbWV3b3JrX2t3YXJncyBpcyBOb25lOgogICAgICAgIGZyYW1ld29ya19rd2FyZ3MgPSB7fQoKICAgICMgUnVuIHRoZSBjb252ZXJzaW9uOgogICAgdHJ5OgogICAgICAgIGNvbnZlcnNpb25fZnVuY3Rpb24oCiAgICAgICAgICAgIG1vZGVsX2hhbmRsZXI9bW9kZWxfaGFuZGxlciwKICAgICAgICAgICAgb25ueF9tb2RlbF9uYW1lPW9ubnhfbW9kZWxfbmFtZSwKICAgICAgICAgICAgb3B0aW1pemVfbW9kZWw9b3B0aW1pemVfbW9kZWwsCiAgICAgICAgICAgICoqZnJhbWV3b3JrX2t3YXJncywKICAgICAgICApCiAgICBleGNlcHQgVHlwZUVycm9yIGFzIGV4Y2VwdGlvbjoKICAgICAgICByYWlzZSBtbHJ1bi5lcnJvcnMuTUxSdW5JbnZhbGlkQXJndW1lbnRFcnJvcigKICAgICAgICAgICAgZiJFUlJPUjogQSBUeXBlRXJyb3IgZXhjZXB0aW9uIHdhcyByYWlzZWQgZHVyaW5nIHRoZSBjb252ZXJzaW9uOlxue2V4Y2VwdGlvbn0uICIKICAgICAgICAgICAgZiJQbGVhc2UgcmVhZCB0aGUge2ZyYW1ld29ya30gZnJhbWV3b3JrIGNvbnZlcnNpb24gZnVuY3Rpb24gZG9jIHN0cmluZyBieSBwYXNzaW5nICdoZWxwJyBpbiB0aGUgIgogICAgICAgICAgICBmIidmcmFtZXdvcmtfa3dhcmdzJyBkaWN0aW9uYXJ5IHBhcmFtZXRlci4iCiAgICAgICAgKQoKCmRlZiBvcHRpbWl6ZSgKICAgIGNvbnRleHQ6IG1scnVuLk1MQ2xpZW50Q3R4LAogICAgbW9kZWxfcGF0aDogc3RyLAogICAgb3B0aW1pemF0aW9uczogTGlzdFtzdHJdID0gTm9uZSwKICAgIGZpeGVkX3BvaW50OiBib29sID0gRmFsc2UsCiAgICBvcHRpbWl6ZWRfbW9kZWxfbmFtZTogc3RyID0gTm9uZSwKKToKICAgICIiIgogICAgT3B0aW1pemUgdGhlIGdpdmVuIE9OTlggbW9kZWwuCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgICAgICBUaGUgTUxSdW4gZnVuY3Rpb24gZXhlY3V0aW9uIGNvbnRleHQuCiAgICA6cGFyYW0gbW9kZWxfcGF0aDogICAgICAgICAgIFBhdGggdG8gdGhlIE9OTlggbW9kZWwgb2JqZWN0LgogICAgOnBhcmFtIG9wdGltaXphdGlvbnM6ICAgICAgICBMaXN0IG9mIHBvc3NpYmxlIG9wdGltaXphdGlvbnMuIFRvIHNlZSB3aGF0IG9wdGltaXphdGlvbnMgYXJlIGF2YWlsYWJsZSwgcGFzcyAiaGVscCIuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIE5vbmUsIGFsbCBvZiB0aGUgb3B0aW1pemF0aW9ucyB3aWxsIGJlIHVzZWQuIERlZmF1bHRlZCB0byBOb25lLgogICAgOnBhcmFtIGZpeGVkX3BvaW50OiAgICAgICAgICBPcHRpbWl6ZSB0aGUgd2VpZ2h0cyB1c2luZyBmaXhlZCBwb2ludC4gRGVmYXVsdGVkIHRvIEZhbHNlLgogICAgOnBhcmFtIG9wdGltaXplZF9tb2RlbF9uYW1lOiBUaGUgbmFtZSBvZiB0aGUgb3B0aW1pemVkIG1vZGVsLiBJZiBOb25lLCB0aGUgb3JpZ2luYWwgbW9kZWwgd2lsbCBiZSBvdmVycmlkZGVuLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0ZWQgdG8gTm9uZS4KICAgICIiIgogICAgIyBJbXBvcnQgdGhlIG1vZGVsIGhhbmRsZXI6CiAgICBpbXBvcnQgb25ueG9wdGltaXplcgogICAgZnJvbSBtbHJ1bi5mcmFtZXdvcmtzLm9ubnggaW1wb3J0IE9OTlhNb2RlbEhhbmRsZXIKCiAgICAjIENoZWNrIGlmIG5lZWRlZCB0byBwcmludCB0aGUgYXZhaWxhYmxlIG9wdGltaXphdGlvbnMgKCJoZWxwIiBpcyBwYXNzZWQpOgogICAgaWYgb3B0aW1pemF0aW9ucyA9PSAiaGVscCI6CiAgICAgICAgYXZhaWxhYmxlX3Bhc3NlcyA9ICJcbiogIi5qb2luKG9ubnhvcHRpbWl6ZXIuZ2V0X2F2YWlsYWJsZV9wYXNzZXMoKSkKICAgICAgICBwcmludChmIlRoZSBhdmFpbGFibGUgb3B0aW1pemF0aW9ucyBhcmU6XG4qIHthdmFpbGFibGVfcGFzc2VzfSIpCiAgICAgICAgcmV0dXJuCgogICAgIyBDcmVhdGUgdGhlIG1vZGVsIGhhbmRsZXI6CiAgICBtb2RlbF9oYW5kbGVyID0gT05OWE1vZGVsSGFuZGxlcigKICAgICAgICBtb2RlbF9wYXRoPW1vZGVsX3BhdGgsIGNvbnRleHQ9Y29udGV4dAogICAgKQoKICAgICMgTG9hZCB0aGUgT05OWCBtb2RlbDoKICAgIG1vZGVsX2hhbmRsZXIubG9hZCgpCgogICAgIyBPcHRpbWl6ZSB0aGUgbW9kZWwgdXNpbmcgdGhlIGdpdmVuIGNvbmZpZ3VyYXRpb25zOgogICAgbW9kZWxfaGFuZGxlci5vcHRpbWl6ZShvcHRpbWl6YXRpb25zPW9wdGltaXphdGlvbnMsIGZpeGVkX3BvaW50PWZpeGVkX3BvaW50KQoKICAgICMgUmVuYW1lIGlmIG5lZWRlZDoKICAgIGlmIG9wdGltaXplZF9tb2RlbF9uYW1lIGlzIG5vdCBOb25lOgogICAgICAgIG1vZGVsX2hhbmRsZXIuc2V0X21vZGVsX25hbWUobW9kZWxfbmFtZT1vcHRpbWl6ZWRfbW9kZWxfbmFtZSkKCiAgICAjIExvZyB0aGUgb3B0aW1pemVkIG1vZGVsOgogICAgbW9kZWxfaGFuZGxlci5sb2coKQo=
    commands: []
    code_origin: https://github.com/guy1992l/functions.git#93e56754f29e39e12bec37693e27ccf17d80dbc1:/Users/guyl/Projects/functions/onnx_utils/onnx_utils.py
    origin_filename: /Users/guyl/Projects/functions/onnx_utils/onnx_utils.py
  disable_auto_mount: false
  priority_class_name: ''
  affinity: null
verbose: false
