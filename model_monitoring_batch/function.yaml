kind: job
metadata:
  name: model-monitoring-batch
  tag: ''
  hash: ce973a17aedd14e2a0e9d7ecc138ec6dd088cb36
  project: default
  categories:
  - monitoring
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  env: []
  default_handler: handler
  entry_points:
    compute:
      name: compute
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: capping
        default: null
      - name: kld_scaling
        default: 0.0001
      outputs:
      - default: ''
        type: float
      lineno: 64
    dict_to_histogram:
      name: dict_to_histogram
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: histogram_dict
        default: ''
      outputs:
      - default: ''
      lineno: 112
    compute_metrics_over_df:
      name: compute_metrics_over_df
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: base_histogram
        default: ''
      - name: latest_histogram
        default: ''
      outputs:
      - default: ''
      lineno: 129
    compute_drift_from_histograms:
      name: compute_drift_from_histograms
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: feature_stats
        default: ''
      - name: current_stats
        default: ''
      outputs:
      - default: ''
      lineno: 140
    post_init:
      name: post_init
      doc: ''
      parameters:
      - name: self
        default: ''
      outputs:
      - default: ''
      lineno: 278
    run:
      name: run
      doc: ''
      parameters:
      - name: self
        default: ''
      outputs:
      - default: ''
      lineno: 290
    check_for_drift:
      name: check_for_drift
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: drift_result
        default: ''
      - name: endpoint
        default: ''
      outputs:
      - default: ''
      lineno: 416
    get_last_created_dir:
      name: get_last_created_dir
      doc: ''
      parameters:
      - name: fs
        default: ''
      - name: endpoint_dir
        default: ''
      outputs:
      - default: ''
      lineno: 442
    handler:
      name: handler
      doc: ''
      parameters:
      - name: context
        type: MLClientCtx
        default: ''
      outputs:
      - default: ''
      lineno: 448
  description: ''
  build:
    functionSourceCode: aW1wb3J0IGpzb24KaW1wb3J0IG9zCmZyb20gY29sbGVjdGlvbnMgaW1wb3J0IGRlZmF1bHRkaWN0CmZyb20gZGF0YWNsYXNzZXMgaW1wb3J0IGRhdGFjbGFzcwpmcm9tIHR5cGluZyBpbXBvcnQgT3B0aW9uYWwsIExpc3QsIERpY3QKCmltcG9ydCBudW1weSBhcyBucAppbXBvcnQgcGFuZGFzIGFzIHBkCmltcG9ydCB2M2lvCmZyb20gbWxydW4gaW1wb3J0IGdldF9ydW5fZGIKZnJvbSBtbHJ1biBpbXBvcnQgc3RvcmVfbWFuYWdlcgpmcm9tIG1scnVuLmRhdGFfdHlwZXMuaW5mZXIgaW1wb3J0IERGRGF0YUluZmVyLCBJbmZlck9wdGlvbnMKZnJvbSBtbHJ1bi5ydW4gaW1wb3J0IE1MQ2xpZW50Q3R4CmZyb20gbWxydW4udXRpbHMgaW1wb3J0IGxvZ2dlciwgY29uZmlnCmZyb20gbWxydW4udXRpbHMubW9kZWxfbW9uaXRvcmluZyBpbXBvcnQgRW5kcG9pbnRUeXBlLCBwYXJzZV9tb2RlbF9lbmRwb2ludF9zdG9yZV9wcmVmaXgKZnJvbSBtbHJ1bi51dGlscy52M2lvX2NsaWVudHMgaW1wb3J0IGdldF92M2lvX2NsaWVudCwgZ2V0X2ZyYW1lc19jbGllbnQKZnJvbSBza2xlYXJuLnByZXByb2Nlc3NpbmcgaW1wb3J0IEtCaW5zRGlzY3JldGl6ZXIKClRJTUVfRk9STUFUID0gIiVZLSVtLSVkICVIOiVNOiVTLiVmJXoiCgoKQGRhdGFjbGFzcwpjbGFzcyBUb3RhbFZhcmlhbmNlRGlzdGFuY2U6CiAgICAiIiIKICAgIFByb3ZpZGVzIGEgc3ltbWV0cmljIGRyaWZ0IGRpc3RhbmNlIGJldHdlZW4gdHdvIHBlcmlvZHMgdCBhbmQgdQogICAgWiAtIHZlY3RvciBvZiByYW5kb20gdmFyaWFibGVzCiAgICBQdCAtIFByb2JhYmlsaXR5IGRpc3RyaWJ1dGlvbiBvdmVyIHRpbWUgc3BhbiB0CiAgICAiIiIKCiAgICBkaXN0cmliX3Q6IG5wLm5kYXJyYXkKICAgIGRpc3RyaWJfdTogbnAubmRhcnJheQoKICAgIGRlZiBjb21wdXRlKHNlbGYpIC0+IGZsb2F0OgogICAgICAgIHJldHVybiBucC5zdW0obnAuYWJzKHNlbGYuZGlzdHJpYl90IC0gc2VsZi5kaXN0cmliX3UpKSAvIDIKCgpAZGF0YWNsYXNzCmNsYXNzIEhlbGxpbmdlckRpc3RhbmNlOgogICAgIiIiCiAgICBIZWxsaW5nZXIgZGlzdGFuY2UgaXMgYW4gZiBkaXZlcmdlbmNlIG1lYXN1cmUsIHNpbWlsYXIgdG8gdGhlIEt1bGxiYWNrLUxlaWJsZXIgKEtMKSBkaXZlcmdlbmNlLgogICAgSG93ZXZlciwgdW5saWtlIEtMIERpdmVyZ2VuY2UgdGhlIEhlbGxpbmdlciBkaXZlcmdlbmNlIGlzIHN5bW1ldHJpYyBhbmQgYm91bmRlZCBvdmVyIGEgcHJvYmFiaWxpdHkgc3BhY2UuCiAgICAiIiIKCiAgICBkaXN0cmliX3Q6IG5wLm5kYXJyYXkKICAgIGRpc3RyaWJfdTogbnAubmRhcnJheQoKICAgIGRlZiBjb21wdXRlKHNlbGYpIC0+IGZsb2F0OgogICAgICAgIHJldHVybiBucC5zcXJ0KAogICAgICAgICAgICAwLjUgKiAoKG5wLnNxcnQoc2VsZi5kaXN0cmliX3UpIC0gbnAuc3FydChzZWxmLmRpc3RyaWJfdCkpICoqIDIpLnN1bSgpCiAgICAgICAgKQoKCkBkYXRhY2xhc3MKY2xhc3MgS3VsbGJhY2tMZWlibGVyRGl2ZXJnZW5jZToKICAgICIiIgogICAgS0wgRGl2ZXJnZW5jZSAob3IgcmVsYXRpdmUgZW50cm9weSkgaXMgYSBtZWFzdXJlIG9mIGhvdyBvbmUgcHJvYmFiaWxpdHkgZGlzdHJpYnV0aW9uIGRpZmZlcnMgZnJvbSBhbm90aGVyLgogICAgSXQgaXMgYW4gYXN5bW1ldHJpYyBtZWFzdXJlICh0aHVzIGl0J3Mgbm90IGEgbWV0cmljKSBhbmQgaXQgZG9lc24ndCBzYXRpc2Z5IHRoZSB0cmlhbmdsZSBpbmVxdWFsaXR5LgogICAgS0wgRGl2ZXJnZW5jZSBvZiAwLCBpbmRpY2F0ZXMgdHdvIGlkZW50aWNhbCBkaXN0cmlidXRpb25zLgogICAgIiIiCgogICAgZGlzdHJpYl90OiBucC5uZGFycmF5CiAgICBkaXN0cmliX3U6IG5wLm5kYXJyYXkKCiAgICBkZWYgY29tcHV0ZShzZWxmLCBjYXBwaW5nPU5vbmUsIGtsZF9zY2FsaW5nPTAuMDAwMSkgLT4gZmxvYXQ6CiAgICAgICAgdF91ID0gbnAuc3VtKAogICAgICAgICAgICBucC53aGVyZSgKICAgICAgICAgICAgICAgIHNlbGYuZGlzdHJpYl90ICE9IDAsCiAgICAgICAgICAgICAgICAoc2VsZi5kaXN0cmliX3QpCiAgICAgICAgICAgICAgICAqIG5wLmxvZygKICAgICAgICAgICAgICAgICAgICBzZWxmLmRpc3RyaWJfdAogICAgICAgICAgICAgICAgICAgIC8gbnAud2hlcmUoc2VsZi5kaXN0cmliX3UgIT0gMCwgc2VsZi5kaXN0cmliX3UsIGtsZF9zY2FsaW5nKQogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICkKICAgICAgICApCiAgICAgICAgdV90ID0gbnAuc3VtKAogICAgICAgICAgICBucC53aGVyZSgKICAgICAgICAgICAgICAgIHNlbGYuZGlzdHJpYl91ICE9IDAsCiAgICAgICAgICAgICAgICAoc2VsZi5kaXN0cmliX3UpCiAgICAgICAgICAgICAgICAqIG5wLmxvZygKICAgICAgICAgICAgICAgICAgICBzZWxmLmRpc3RyaWJfdQogICAgICAgICAgICAgICAgICAgIC8gbnAud2hlcmUoc2VsZi5kaXN0cmliX3QgIT0gMCwgc2VsZi5kaXN0cmliX3QsIGtsZF9zY2FsaW5nKQogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICkKICAgICAgICApCiAgICAgICAgcmVzdWx0ID0gdF91ICsgdV90CiAgICAgICAgaWYgY2FwcGluZzoKICAgICAgICAgICAgcmV0dXJuIGNhcHBpbmcgaWYgcmVzdWx0ID09IGZsb2F0KCJpbmYiKSBlbHNlIHJlc3VsdAogICAgICAgIHJldHVybiByZXN1bHQKCgpjbGFzcyBWaXJ0dWFsRHJpZnQ6CiAgICBkZWYgX19pbml0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBwcmVkaWN0aW9uX2NvbDogT3B0aW9uYWxbc3RyXSA9IE5vbmUsCiAgICAgICAgbGFiZWxfY29sOiBPcHRpb25hbFtzdHJdID0gTm9uZSwKICAgICAgICBmZWF0dXJlX3dlaWdodHM6IE9wdGlvbmFsW0xpc3RbZmxvYXRdXSA9IE5vbmUsCiAgICAgICAgaW5mX2NhcHBpbmc6IE9wdGlvbmFsW2Zsb2F0XSA9IDEwLAogICAgKToKICAgICAgICBzZWxmLnByZWRpY3Rpb25fY29sID0gcHJlZGljdGlvbl9jb2wKICAgICAgICBzZWxmLmxhYmVsX2NvbCA9IGxhYmVsX2NvbAogICAgICAgIHNlbGYuZmVhdHVyZV93ZWlnaHRzID0gZmVhdHVyZV93ZWlnaHRzCiAgICAgICAgc2VsZi5jYXBwaW5nID0gaW5mX2NhcHBpbmcKICAgICAgICBzZWxmLmRpc2NyZXRpemVyczogRGljdFtzdHIsIEtCaW5zRGlzY3JldGl6ZXJdID0ge30KICAgICAgICBzZWxmLm1ldHJpY3MgPSB7CiAgICAgICAgICAgICJ0dmQiOiBUb3RhbFZhcmlhbmNlRGlzdGFuY2UsCiAgICAgICAgICAgICJoZWxsaW5nZXIiOiBIZWxsaW5nZXJEaXN0YW5jZSwKICAgICAgICAgICAgImtsZCI6IEt1bGxiYWNrTGVpYmxlckRpdmVyZ2VuY2UsCiAgICAgICAgfQoKICAgIGRlZiBkaWN0X3RvX2hpc3RvZ3JhbShzZWxmLCBoaXN0b2dyYW1fZGljdCk6CiAgICAgICAgaGlzdG9ncmFtcyA9IHt9CiAgICAgICAgZm9yIGZlYXR1cmUsIHN0YXRzIGluIGhpc3RvZ3JhbV9kaWN0Lml0ZW1zKCk6CiAgICAgICAgICAgIGhpc3RvZ3JhbXNbZmVhdHVyZV0gPSBzdGF0c1siaGlzdCJdWzBdCgogICAgICAgICMgR2V0IGZlYXR1cmVzIHZhbHVlIGNvdW50cwogICAgICAgIGhpc3RvZ3JhbXMgPSBwZC5jb25jYXQoCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIHBkLkRhdGFGcmFtZShkYXRhPWhpc3QsIGNvbHVtbnM9W2ZlYXR1cmVdKQogICAgICAgICAgICAgICAgZm9yIGZlYXR1cmUsIGhpc3QgaW4gaGlzdG9ncmFtcy5pdGVtcygpCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIGF4aXM9MSwKICAgICAgICApCiAgICAgICAgIyBUbyBEaXN0cmlidXRpb24KICAgICAgICBoaXN0b2dyYW1zID0gaGlzdG9ncmFtcyAvIGhpc3RvZ3JhbXMuc3VtKCkKICAgICAgICByZXR1cm4gaGlzdG9ncmFtcwoKICAgIGRlZiBjb21wdXRlX21ldHJpY3Nfb3Zlcl9kZihzZWxmLCBiYXNlX2hpc3RvZ3JhbSwgbGF0ZXN0X2hpc3RvZ3JhbSk6CiAgICAgICAgZHJpZnRfbWVhc3VyZXMgPSB7fQogICAgICAgIGZvciBtZXRyaWNfbmFtZSwgbWV0cmljIGluIHNlbGYubWV0cmljcy5pdGVtcygpOgogICAgICAgICAgICBkcmlmdF9tZWFzdXJlc1ttZXRyaWNfbmFtZV0gPSB7CiAgICAgICAgICAgICAgICBmZWF0dXJlOiBtZXRyaWMoCiAgICAgICAgICAgICAgICAgICAgYmFzZV9oaXN0b2dyYW0ubG9jWzosIGZlYXR1cmVdLCBsYXRlc3RfaGlzdG9ncmFtLmxvY1s6LCBmZWF0dXJlXQogICAgICAgICAgICAgICAgKS5jb21wdXRlKCkKICAgICAgICAgICAgICAgIGZvciBmZWF0dXJlIGluIGJhc2VfaGlzdG9ncmFtCiAgICAgICAgICAgIH0KICAgICAgICByZXR1cm4gZHJpZnRfbWVhc3VyZXMKCiAgICBkZWYgY29tcHV0ZV9kcmlmdF9mcm9tX2hpc3RvZ3JhbXMoc2VsZiwgZmVhdHVyZV9zdGF0cywgY3VycmVudF9zdGF0cyk6CiAgICAgICAgIyBQcm9jZXNzIGhpc3RvZ3JhbSBkaWN0aW9uYXJpZXMgdG8gRGF0YWZyYW1lIG9mIHRoZSBoaXN0b2dyYW1zCiAgICAgICAgIyB3aXRoIEZlYXR1cmUgaGlzdG9ncmFtIGFzIGNvbHMKICAgICAgICBiYXNlX2hpc3RvZ3JhbSA9IHNlbGYuZGljdF90b19oaXN0b2dyYW0oZmVhdHVyZV9zdGF0cykKICAgICAgICBsYXRlc3RfaGlzdG9ncmFtID0gc2VsZi5kaWN0X3RvX2hpc3RvZ3JhbShjdXJyZW50X3N0YXRzKQoKICAgICAgICAjIFZlcmlmeSBhbGwgdGhlIGZlYXR1cmVzIGV4aXN0IGJldHdlZW4gZGF0YXNldHMKICAgICAgICBiYXNlX2ZlYXR1cmVzID0gc2V0KGJhc2VfaGlzdG9ncmFtLmNvbHVtbnMpCiAgICAgICAgbGF0ZXN0X2ZlYXR1cmVzID0gc2V0KGxhdGVzdF9oaXN0b2dyYW0uY29sdW1ucykKCiAgICAgICAgZmVhdHVyZXNfY29tbW9uID0gbGlzdChiYXNlX2ZlYXR1cmVzLmludGVyc2VjdGlvbihsYXRlc3RfZmVhdHVyZXMpKQogICAgICAgIGZlYXR1cmVfZGlmZmVyZW5jZSA9IGxpc3QoYmFzZV9mZWF0dXJlcyBeIGxhdGVzdF9mZWF0dXJlcykKCiAgICAgICAgaWYgbm90IGZlYXR1cmVzX2NvbW1vbjoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigKICAgICAgICAgICAgICAgIGYiTm8gY29tbW9uIGZlYXR1cmVzIGZvdW5kOiB7YmFzZV9mZWF0dXJlc30gPD4ge2xhdGVzdF9mZWF0dXJlc30iCiAgICAgICAgICAgICkKCiAgICAgICAgYmFzZV9oaXN0b2dyYW0gPSBiYXNlX2hpc3RvZ3JhbS5kcm9wKAogICAgICAgICAgICBmZWF0dXJlX2RpZmZlcmVuY2UsIGF4aXM9MSwgZXJyb3JzPSJpZ25vcmUiCiAgICAgICAgKQogICAgICAgIGxhdGVzdF9oaXN0b2dyYW0gPSBsYXRlc3RfaGlzdG9ncmFtLmRyb3AoCiAgICAgICAgICAgIGZlYXR1cmVfZGlmZmVyZW5jZSwgYXhpcz0xLCBlcnJvcnM9Imlnbm9yZSIKICAgICAgICApCgogICAgICAgICMgQ29tcHV0ZSB0aGUgZHJpZnQgcGVyIGZlYXR1cmUKICAgICAgICBmZWF0dXJlc19kcmlmdF9tZWFzdXJlcyA9IHNlbGYuY29tcHV0ZV9tZXRyaWNzX292ZXJfZGYoCiAgICAgICAgICAgIGJhc2VfaGlzdG9ncmFtLmxvY1s6LCBmZWF0dXJlc19jb21tb25dLAogICAgICAgICAgICBsYXRlc3RfaGlzdG9ncmFtLmxvY1s6LCBmZWF0dXJlc19jb21tb25dLAogICAgICAgICkKCiAgICAgICAgIyBDb21wdXRlIHRvdGFsIGRyaWZ0IG1lYXN1cmVzIGZvciBmZWF0dXJlcwogICAgICAgIGZvciBtZXRyaWNfbmFtZSBpbiBzZWxmLm1ldHJpY3Mua2V5cygpOgogICAgICAgICAgICBmZWF0dXJlX3ZhbHVlcyA9IGxpc3QoZmVhdHVyZXNfZHJpZnRfbWVhc3VyZXNbbWV0cmljX25hbWVdLnZhbHVlcygpKQogICAgICAgICAgICBmZWF0dXJlc19kcmlmdF9tZWFzdXJlc1ttZXRyaWNfbmFtZV1bInRvdGFsX3N1bSJdID0gbnAuc3VtKGZlYXR1cmVfdmFsdWVzKQogICAgICAgICAgICBmZWF0dXJlc19kcmlmdF9tZWFzdXJlc1ttZXRyaWNfbmFtZV1bInRvdGFsX21lYW4iXSA9IG5wLm1lYW4oZmVhdHVyZV92YWx1ZXMpCgogICAgICAgICAgICAjIEFkZCB3ZWlnaHRlZCBtZWFuIGJ5IGdpdmVuIGZlYXR1cmUgd2VpZ2h0cyBpZiBwcm92aWRlZAogICAgICAgICAgICBpZiBzZWxmLmZlYXR1cmVfd2VpZ2h0czoKICAgICAgICAgICAgICAgIGZlYXR1cmVzX2RyaWZ0X21lYXN1cmVzW21ldHJpY19uYW1lXVsidG90YWxfd2VpZ2h0ZWRfbWVhbiJdID0gbnAuZG90KAogICAgICAgICAgICAgICAgICAgIGZlYXR1cmVfdmFsdWVzLCBzZWxmLmZlYXR1cmVfd2VpZ2h0cwogICAgICAgICAgICAgICAgKQoKICAgICAgICBkcmlmdF9yZXN1bHQgPSBkZWZhdWx0ZGljdChkaWN0KQoKICAgICAgICBmb3IgZmVhdHVyZSBpbiBmZWF0dXJlc19jb21tb246CiAgICAgICAgICAgIGZvciBtZXRyaWMsIHZhbHVlcyBpbiBmZWF0dXJlc19kcmlmdF9tZWFzdXJlcy5pdGVtcygpOgogICAgICAgICAgICAgICAgZHJpZnRfcmVzdWx0W2ZlYXR1cmVdW21ldHJpY10gPSB2YWx1ZXNbZmVhdHVyZV0KICAgICAgICAgICAgICAgIHN1bSA9IGZlYXR1cmVzX2RyaWZ0X21lYXN1cmVzW21ldHJpY11bInRvdGFsX3N1bSJdCiAgICAgICAgICAgICAgICBtZWFuID0gZmVhdHVyZXNfZHJpZnRfbWVhc3VyZXNbbWV0cmljXVsidG90YWxfbWVhbiJdCiAgICAgICAgICAgICAgICBkcmlmdF9yZXN1bHRbZiJ7bWV0cmljfV9zdW0iXSA9IHN1bQogICAgICAgICAgICAgICAgZHJpZnRfcmVzdWx0W2Yie21ldHJpY31fbWVhbiJdID0gbWVhbgogICAgICAgICAgICAgICAgaWYgc2VsZi5mZWF0dXJlX3dlaWdodHM6CiAgICAgICAgICAgICAgICAgICAgbWV0cmljX21lYXN1cmUgPSBmZWF0dXJlc19kcmlmdF9tZWFzdXJlc1ttZXRyaWNdCiAgICAgICAgICAgICAgICAgICAgd2VpZ2h0ZWRfbWVhbiA9IG1ldHJpY19tZWFzdXJlWyJ0b3RhbF93ZWlnaHRlZF9tZWFuIl0KICAgICAgICAgICAgICAgICAgICBkcmlmdF9yZXN1bHRbZiJ7bWV0cmljfV93ZWlnaHRlZF9tZWFuIl0gPSB3ZWlnaHRlZF9tZWFuCgogICAgICAgIGlmIHNlbGYubGFiZWxfY29sOgogICAgICAgICAgICBsYWJlbF9kcmlmdF9tZWFzdXJlcyA9IHNlbGYuY29tcHV0ZV9tZXRyaWNzX292ZXJfZGYoCiAgICAgICAgICAgICAgICBiYXNlX2hpc3RvZ3JhbS5sb2NbOiwgc2VsZi5sYWJlbF9jb2xdLAogICAgICAgICAgICAgICAgbGF0ZXN0X2hpc3RvZ3JhbS5sb2NbOiwgc2VsZi5sYWJlbF9jb2xdLAogICAgICAgICAgICApCiAgICAgICAgICAgIGZvciBtZXRyaWMsIHZhbHVlcyBpbiBsYWJlbF9kcmlmdF9tZWFzdXJlcy5pdGVtcygpOgogICAgICAgICAgICAgICAgZHJpZnRfcmVzdWx0W3NlbGYubGFiZWxfY29sXVttZXRyaWNdID0gdmFsdWVzW21ldHJpY10KCiAgICAgICAgaWYgc2VsZi5wcmVkaWN0aW9uX2NvbDoKICAgICAgICAgICAgcHJlZGljdGlvbl9kcmlmdF9tZWFzdXJlcyA9IHNlbGYuY29tcHV0ZV9tZXRyaWNzX292ZXJfZGYoCiAgICAgICAgICAgICAgICBiYXNlX2hpc3RvZ3JhbS5sb2NbOiwgc2VsZi5wcmVkaWN0aW9uX2NvbF0sCiAgICAgICAgICAgICAgICBsYXRlc3RfaGlzdG9ncmFtLmxvY1s6LCBzZWxmLnByZWRpY3Rpb25fY29sXSwKICAgICAgICAgICAgKQogICAgICAgICAgICBmb3IgbWV0cmljLCB2YWx1ZXMgaW4gcHJlZGljdGlvbl9kcmlmdF9tZWFzdXJlcy5pdGVtcygpOgogICAgICAgICAgICAgICAgZHJpZnRfcmVzdWx0W3NlbGYucHJlZGljdGlvbl9jb2xdW21ldHJpY10gPSB2YWx1ZXNbbWV0cmljXQoKICAgICAgICByZXR1cm4gZHJpZnRfcmVzdWx0CgoKY2xhc3MgQmF0Y2hQcm9jZXNzb3I6CiAgICBkZWYgX19pbml0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgICAgICBwcm9qZWN0OiBzdHIsCiAgICAgICAgbW9kZWxfbW9uaXRvcmluZ19hY2Nlc3Nfa2V5OiBzdHIsCiAgICApOgogICAgICAgIHNlbGYuY29udGV4dCA9IGNvbnRleHQKICAgICAgICBzZWxmLnByb2plY3QgPSBwcm9qZWN0CgogICAgICAgIHNlbGYubW9kZWxfbW9uaXRvcmluZ19hY2Nlc3Nfa2V5ID0gbW9kZWxfbW9uaXRvcmluZ19hY2Nlc3Nfa2V5CgogICAgICAgIHNlbGYudmlydHVhbF9kcmlmdCA9IFZpcnR1YWxEcmlmdChpbmZfY2FwcGluZz0xMCkKCiAgICAgICAgdGVtcGxhdGUgPSBjb25maWcubW9kZWxfZW5kcG9pbnRfbW9uaXRvcmluZy5zdG9yZV9wcmVmaXhlcy5kZWZhdWx0CgogICAgICAgIGt2X3BhdGggPSB0ZW1wbGF0ZS5mb3JtYXQocHJvamVjdD1zZWxmLnByb2plY3QsIGtpbmQ9ImVuZHBvaW50cyIpCiAgICAgICAgXywgc2VsZi5rdl9jb250YWluZXIsIHNlbGYua3ZfcGF0aCA9IHBhcnNlX21vZGVsX2VuZHBvaW50X3N0b3JlX3ByZWZpeChrdl9wYXRoKQoKICAgICAgICB0c2RiX3BhdGggPSB0ZW1wbGF0ZS5mb3JtYXQocHJvamVjdD1wcm9qZWN0LCBraW5kPSJldmVudHMiKQogICAgICAgIF8sIHNlbGYudHNkYl9jb250YWluZXIsIHNlbGYudHNkYl9wYXRoID0gcGFyc2VfbW9kZWxfZW5kcG9pbnRfc3RvcmVfcHJlZml4KAogICAgICAgICAgICB0c2RiX3BhdGgKICAgICAgICApCgogICAgICAgIHN0cmVhbV9wYXRoID0gdGVtcGxhdGUuZm9ybWF0KHByb2plY3Q9c2VsZi5wcm9qZWN0LCBraW5kPSJsb2dfc3RyZWFtIikKICAgICAgICBfLCBzZWxmLnN0cmVhbV9jb250YWluZXIsIHNlbGYuc3RyZWFtX3BhdGggPSBwYXJzZV9tb2RlbF9lbmRwb2ludF9zdG9yZV9wcmVmaXgoCiAgICAgICAgICAgIHN0cmVhbV9wYXRoCiAgICAgICAgKQoKICAgICAgICBzZWxmLnBhcnF1ZXRfcGF0aCA9IGNvbmZpZy5tb2RlbF9lbmRwb2ludF9tb25pdG9yaW5nLnN0b3JlX3ByZWZpeGVzLnVzZXJfc3BhY2UuZm9ybWF0KAogICAgICAgICAgICBwcm9qZWN0PXByb2plY3QsIGtpbmQ9InBhcnF1ZXQiCiAgICAgICAgKQoKICAgICAgICBsb2dnZXIuaW5mbygKICAgICAgICAgICAgIkluaXRpYWxpemluZyBCYXRjaFByb2Nlc3NvciIsCiAgICAgICAgICAgIHByb2plY3Q9cHJvamVjdCwKICAgICAgICAgICAgbW9kZWxfbW9uaXRvcmluZ19hY2Nlc3Nfa2V5X2luaXRhbGl6ZWQ9Ym9vbChtb2RlbF9tb25pdG9yaW5nX2FjY2Vzc19rZXkpLAogICAgICAgICAgICBwYXJxdWV0X3BhdGg9c2VsZi5wYXJxdWV0X3BhdGgsCiAgICAgICAgICAgIGt2X2NvbnRhaW5lcj1zZWxmLmt2X2NvbnRhaW5lciwKICAgICAgICAgICAga3ZfcGF0aD1zZWxmLmt2X3BhdGgsCiAgICAgICAgICAgIHRzZGJfY29udGFpbmVyPXNlbGYudHNkYl9jb250YWluZXIsCiAgICAgICAgICAgIHRzZGJfcGF0aD1zZWxmLnRzZGJfcGF0aCwKICAgICAgICAgICAgc3RyZWFtX2NvbnRhaW5lcj1zZWxmLnN0cmVhbV9jb250YWluZXIsCiAgICAgICAgICAgIHN0cmVhbV9wYXRoPXNlbGYuc3RyZWFtX3BhdGgsCiAgICAgICAgKQoKICAgICAgICBzZWxmLmRlZmF1bHRfcG9zc2libGVfZHJpZnRfdGhyZXNob2xkID0gKAogICAgICAgICAgICBjb25maWcubW9kZWxfZW5kcG9pbnRfbW9uaXRvcmluZy5kcmlmdF90aHJlc2hvbGRzLmRlZmF1bHQucG9zc2libGVfZHJpZnQKICAgICAgICApCiAgICAgICAgc2VsZi5kZWZhdWx0X2RyaWZ0X2RldGVjdGVkX3RocmVzaG9sZCA9ICgKICAgICAgICAgICAgY29uZmlnLm1vZGVsX2VuZHBvaW50X21vbml0b3JpbmcuZHJpZnRfdGhyZXNob2xkcy5kZWZhdWx0LmRyaWZ0X2RldGVjdGVkCiAgICAgICAgKQoKICAgICAgICBzZWxmLmRiID0gZ2V0X3J1bl9kYigpCiAgICAgICAgc2VsZi52M2lvID0gZ2V0X3YzaW9fY2xpZW50KGFjY2Vzc19rZXk9c2VsZi5tb2RlbF9tb25pdG9yaW5nX2FjY2Vzc19rZXkpCiAgICAgICAgc2VsZi5mcmFtZXMgPSBnZXRfZnJhbWVzX2NsaWVudCgKICAgICAgICAgICAgYWRkcmVzcz1jb25maWcudjNpb19mcmFtZXNkLAogICAgICAgICAgICBjb250YWluZXI9c2VsZi50c2RiX2NvbnRhaW5lciwKICAgICAgICAgICAgdG9rZW49c2VsZi5tb2RlbF9tb25pdG9yaW5nX2FjY2Vzc19rZXksCiAgICAgICAgKQogICAgICAgIHNlbGYuZXhjZXB0aW9uID0gTm9uZQoKICAgIGRlZiBwb3N0X2luaXQoc2VsZik6CiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLnYzaW8uY3JlYXRlX3N0cmVhbSgKICAgICAgICAgICAgY29udGFpbmVyPXNlbGYuc3RyZWFtX2NvbnRhaW5lciwKICAgICAgICAgICAgcGF0aD1zZWxmLnN0cmVhbV9wYXRoLAogICAgICAgICAgICBzaGFyZF9jb3VudD0xLAogICAgICAgICAgICByYWlzZV9mb3Jfc3RhdHVzPXYzaW8uZGF0YXBsYW5lLlJhaXNlRm9yU3RhdHVzLm5ldmVyLAogICAgICAgICAgICBhY2Nlc3Nfa2V5PXNlbGYubW9kZWxfbW9uaXRvcmluZ19hY2Nlc3Nfa2V5LAogICAgICAgICkKCiAgICAgICAgaWYgbm90IChyZXNwb25zZS5zdGF0dXNfY29kZSA9PSA0MDAgYW5kICJSZXNvdXJjZUluVXNlIiBpbiBzdHIocmVzcG9uc2UuYm9keSkpOgogICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKFs0MDksIDIwNCwgNDAzXSkKCiAgICBkZWYgcnVuKHNlbGYpOgoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGVuZHBvaW50cyA9IHNlbGYuZGIubGlzdF9tb2RlbF9lbmRwb2ludHMoc2VsZi5wcm9qZWN0KQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJGYWlsZWQgdG8gbGlzdCBlbmRwb2ludHMiLCBleGM9ZSkKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGFjdGl2ZV9lbmRwb2ludHMgPSBzZXQoKQogICAgICAgIGZvciBlbmRwb2ludCBpbiBlbmRwb2ludHMuZW5kcG9pbnRzOgogICAgICAgICAgICBpZiBlbmRwb2ludC5zcGVjLmFjdGl2ZToKICAgICAgICAgICAgICAgIGFjdGl2ZV9lbmRwb2ludHMuYWRkKGVuZHBvaW50Lm1ldGFkYXRhLnVpZCkKCiAgICAgICAgc3RvcmUsIHN1YiA9IHN0b3JlX21hbmFnZXIuZ2V0X29yX2NyZWF0ZV9zdG9yZShzZWxmLnBhcnF1ZXRfcGF0aCkKICAgICAgICBwcmVmaXggPSBzZWxmLnBhcnF1ZXRfcGF0aC5yZXBsYWNlKHN1YiwgIiIpCiAgICAgICAgZnMgPSBzdG9yZS5nZXRfZmlsZXN5c3RlbShzaWxlbnQ9RmFsc2UpCgogICAgICAgIGlmIG5vdCBmcy5leGlzdHMoc3ViKToKICAgICAgICAgICAgbG9nZ2VyLndhcm4oCiAgICAgICAgICAgICAgICBmIntzdWJ9IGRvZXMgbm90IGV4aXN0IgogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBmb3IgZW5kcG9pbnRfZGlyIGluIGZzLmxzKHN1Yik6CiAgICAgICAgICAgIGVuZHBvaW50X2lkID0gZW5kcG9pbnRfZGlyWyJuYW1lIl0uc3BsaXQoIj0iKVstMV0KICAgICAgICAgICAgaWYgZW5kcG9pbnRfaWQgbm90IGluIGFjdGl2ZV9lbmRwb2ludHM6CiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbGFzdF95ZWFyID0gc2VsZi5nZXRfbGFzdF9jcmVhdGVkX2RpcihmcywgZW5kcG9pbnRfZGlyKQogICAgICAgICAgICAgICAgbGFzdF9tb250aCA9IHNlbGYuZ2V0X2xhc3RfY3JlYXRlZF9kaXIoZnMsIGxhc3RfeWVhcikKICAgICAgICAgICAgICAgIGxhc3RfZGF5ID0gc2VsZi5nZXRfbGFzdF9jcmVhdGVkX2RpcihmcywgbGFzdF9tb250aCkKICAgICAgICAgICAgICAgIGxhc3RfaG91ciA9IHNlbGYuZ2V0X2xhc3RfY3JlYXRlZF9kaXIoZnMsIGxhc3RfZGF5KQoKICAgICAgICAgICAgICAgIGZ1bGxfcGF0aCA9IGYie3ByZWZpeH17bGFzdF9ob3VyWyduYW1lJ119IgoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTm93IHByb2Nlc3Npbmcge2Z1bGxfcGF0aH0iKQoKICAgICAgICAgICAgICAgIGVuZHBvaW50ID0gc2VsZi5kYi5nZXRfbW9kZWxfZW5kcG9pbnQoCiAgICAgICAgICAgICAgICAgICAgcHJvamVjdD1zZWxmLnByb2plY3QsIGVuZHBvaW50X2lkPWVuZHBvaW50X2lkCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgaWYgZW5kcG9pbnQuc3RhdHVzLmVuZHBvaW50X3R5cGUgPT0gRW5kcG9pbnRUeXBlLlJPVVRFUjoKICAgICAgICAgICAgICAgICAgICAjIGVuZHBvaW50LnN0YXR1cy5mZWF0dXJlX3N0YXRzIGlzIE5vbmUKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIntlbmRwb2ludF9pZH0gaXMgcm91dGVyIHNraXBwaW5nIikKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgICAgIGRmID0gcGQucmVhZF9wYXJxdWV0KGZ1bGxfcGF0aCkKICAgICAgICAgICAgICAgIHRpbWVzdGFtcCA9IGRmWyJ0aW1lc3RhbXAiXS5pbG9jWy0xXQoKICAgICAgICAgICAgICAgIG5hbWVkX2ZlYXR1cmVzX2RmID0gbGlzdChkZlsibmFtZWRfZmVhdHVyZXMiXSkKICAgICAgICAgICAgICAgIG5hbWVkX2ZlYXR1cmVzX2RmID0gcGQuRGF0YUZyYW1lKG5hbWVkX2ZlYXR1cmVzX2RmKQoKICAgICAgICAgICAgICAgIGN1cnJlbnRfc3RhdHMgPSBERkRhdGFJbmZlci5nZXRfc3RhdHMoCiAgICAgICAgICAgICAgICAgICAgZGY9bmFtZWRfZmVhdHVyZXNfZGYsIG9wdGlvbnM9SW5mZXJPcHRpb25zLkhpc3RvZ3JhbQogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGRyaWZ0X3Jlc3VsdCA9IHNlbGYudmlydHVhbF9kcmlmdC5jb21wdXRlX2RyaWZ0X2Zyb21faGlzdG9ncmFtcygKICAgICAgICAgICAgICAgICAgICBmZWF0dXJlX3N0YXRzPWVuZHBvaW50LnN0YXR1cy5mZWF0dXJlX3N0YXRzLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfc3RhdHM9Y3VycmVudF9zdGF0cywKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiRHJpZnQgcmVzdWx0IiwgZHJpZnRfcmVzdWx0PWRyaWZ0X3Jlc3VsdCkKCiAgICAgICAgICAgICAgICBkcmlmdF9zdGF0dXMsIGRyaWZ0X21lYXN1cmUgPSBzZWxmLmNoZWNrX2Zvcl9kcmlmdCgKICAgICAgICAgICAgICAgICAgICBkcmlmdF9yZXN1bHQ9ZHJpZnRfcmVzdWx0LCBlbmRwb2ludD1lbmRwb2ludAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKAogICAgICAgICAgICAgICAgICAgICJEcmlmdCBzdGF0dXMiLAogICAgICAgICAgICAgICAgICAgIGVuZHBvaW50X2lkPWVuZHBvaW50X2lkLAogICAgICAgICAgICAgICAgICAgIGRyaWZ0X3N0YXR1cz1kcmlmdF9zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgZHJpZnRfbWVhc3VyZT1kcmlmdF9tZWFzdXJlLAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGlmIGRyaWZ0X3N0YXR1cyA9PSAiUE9TU0lCTEVfRFJJRlQiIG9yIGRyaWZ0X3N0YXR1cyA9PSAiRFJJRlRfREVURUNURUQiOgogICAgICAgICAgICAgICAgICAgIHNlbGYudjNpby5zdHJlYW0ucHV0X3JlY29yZHMoCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcj1zZWxmLnN0cmVhbV9jb250YWluZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbV9wYXRoPXNlbGYuc3RyZWFtX3BhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZHM9WwogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkYXRhIjoganNvbi5kdW1wcygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImVuZHBvaW50X2lkIjogZW5kcG9pbnRfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZHJpZnRfc3RhdHVzIjogZHJpZnRfc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRyaWZ0X21lYXN1cmUiOiBkcmlmdF9tZWFzdXJlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRyaWZ0X3Blcl9mZWF0dXJlIjogeyoqZHJpZnRfcmVzdWx0fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgc2VsZi52M2lvLmt2LnVwZGF0ZSgKICAgICAgICAgICAgICAgICAgICBjb250YWluZXI9c2VsZi5rdl9jb250YWluZXIsCiAgICAgICAgICAgICAgICAgICAgdGFibGVfcGF0aD1zZWxmLmt2X3BhdGgsCiAgICAgICAgICAgICAgICAgICAga2V5PWVuZHBvaW50X2lkLAogICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM9ewogICAgICAgICAgICAgICAgICAgICAgICAiY3VycmVudF9zdGF0cyI6IGpzb24uZHVtcHMoY3VycmVudF9zdGF0cyksCiAgICAgICAgICAgICAgICAgICAgICAgICJkcmlmdF9tZWFzdXJlcyI6IGpzb24uZHVtcHMoZHJpZnRfcmVzdWx0KSwKICAgICAgICAgICAgICAgICAgICAgICAgImRyaWZ0X3N0YXR1cyI6IGRyaWZ0X3N0YXR1cywKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIHRzZGJfZHJpZnRfbWVhc3VyZXMgPSB7CiAgICAgICAgICAgICAgICAgICAgImVuZHBvaW50X2lkIjogZW5kcG9pbnRfaWQsCiAgICAgICAgICAgICAgICAgICAgInRpbWVzdGFtcCI6IHBkLnRvX2RhdGV0aW1lKHRpbWVzdGFtcCwgZm9ybWF0PVRJTUVfRk9STUFUKSwKICAgICAgICAgICAgICAgICAgICAicmVjb3JkX3R5cGUiOiAiZHJpZnRfbWVhc3VyZXMiLAogICAgICAgICAgICAgICAgICAgICJ0dmRfbWVhbiI6IGRyaWZ0X3Jlc3VsdFsidHZkX21lYW4iXSwKICAgICAgICAgICAgICAgICAgICAia2xkX21lYW4iOiBkcmlmdF9yZXN1bHRbImtsZF9tZWFuIl0sCiAgICAgICAgICAgICAgICAgICAgImhlbGxpbmdlcl9tZWFuIjogZHJpZnRfcmVzdWx0WyJoZWxsaW5nZXJfbWVhbiJdLAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHNlbGYuZnJhbWVzLndyaXRlKAogICAgICAgICAgICAgICAgICAgIGJhY2tlbmQ9InRzZGIiLAogICAgICAgICAgICAgICAgICAgIHRhYmxlPXNlbGYudHNkYl9wYXRoLAogICAgICAgICAgICAgICAgICAgIGRmcz1wZC5EYXRhRnJhbWUuZnJvbV9kaWN0KFt0c2RiX2RyaWZ0X21lYXN1cmVzXSksCiAgICAgICAgICAgICAgICAgICAgaW5kZXhfY29scz1bInRpbWVzdGFtcCIsICJlbmRwb2ludF9pZCIsICJyZWNvcmRfdHlwZSJdLAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiRG9uZSB1cGRhdGluZyBkcmlmdCBtZWFzdXJlcyB7ZnVsbF9wYXRofSIpCgogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJFeGNlcHRpb24gZm9yIGVuZHBvaW50IHtlbmRwb2ludF9pZH0iKQogICAgICAgICAgICAgICAgc2VsZi5leGNlcHRpb24gPSBlCgogICAgZGVmIGNoZWNrX2Zvcl9kcmlmdChzZWxmLCBkcmlmdF9yZXN1bHQsIGVuZHBvaW50KToKICAgICAgICB0dmRfbWVhbiA9IGRyaWZ0X3Jlc3VsdC5nZXQoInR2ZF9tZWFuIikKICAgICAgICBoZWxsaW5nZXJfbWVhbiA9IGRyaWZ0X3Jlc3VsdC5nZXQoImhlbGxpbmdlcl9tZWFuIikKCiAgICAgICAgZHJpZnRfbWVhbiA9IDAuMAogICAgICAgIGlmIHR2ZF9tZWFuIGFuZCBoZWxsaW5nZXJfbWVhbjoKICAgICAgICAgICAgZHJpZnRfbWVhbiA9ICh0dmRfbWVhbiArIGhlbGxpbmdlcl9tZWFuKSAvIDIKCiAgICAgICAgbW9uaXRvcl9jb25maWd1cmF0aW9uID0gZW5kcG9pbnQuc3BlYy5tb25pdG9yX2NvbmZpZ3VyYXRpb24gb3Ige30KCiAgICAgICAgcG9zc2libGVfZHJpZnQgPSBtb25pdG9yX2NvbmZpZ3VyYXRpb24uZ2V0KAogICAgICAgICAgICAicG9zc2libGVfZHJpZnQiLCBzZWxmLmRlZmF1bHRfcG9zc2libGVfZHJpZnRfdGhyZXNob2xkCiAgICAgICAgKQogICAgICAgIGRyaWZ0X2RldGVjdGVkID0gbW9uaXRvcl9jb25maWd1cmF0aW9uLmdldCgKICAgICAgICAgICAgInBvc3NpYmxlX2RyaWZ0Iiwgc2VsZi5kZWZhdWx0X2RyaWZ0X2RldGVjdGVkX3RocmVzaG9sZAogICAgICAgICkKCiAgICAgICAgZHJpZnRfc3RhdHVzID0gIk5PX0RSSUZUIgogICAgICAgIGlmIGRyaWZ0X21lYW4gPj0gZHJpZnRfZGV0ZWN0ZWQ6CiAgICAgICAgICAgIGRyaWZ0X3N0YXR1cyA9ICJEUklGVF9ERVRFQ1RFRCIKICAgICAgICBlbGlmIGRyaWZ0X21lYW4gPj0gcG9zc2libGVfZHJpZnQ6CiAgICAgICAgICAgIGRyaWZ0X3N0YXR1cyA9ICJQT1NTSUJMRV9EUklGVCIKCiAgICAgICAgcmV0dXJuIGRyaWZ0X3N0YXR1cywgZHJpZnRfbWVhbgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBnZXRfbGFzdF9jcmVhdGVkX2RpcihmcywgZW5kcG9pbnRfZGlyKToKICAgICAgICBkaXJzID0gZnMubHMoZW5kcG9pbnRfZGlyWyJuYW1lIl0pCiAgICAgICAgbGFzdF9kaXIgPSBzb3J0ZWQoZGlycywga2V5PWxhbWJkYSBrOiBrWyJuYW1lIl0uc3BsaXQoIj0iKVstMV0pWy0xXQogICAgICAgIHJldHVybiBsYXN0X2RpcgoKCmRlZiBoYW5kbGVyKGNvbnRleHQ6IE1MQ2xpZW50Q3R4KToKICAgIGJhdGNoX3Byb2Nlc3NvciA9IEJhdGNoUHJvY2Vzc29yKAogICAgICAgIGNvbnRleHQ9Y29udGV4dCwKICAgICAgICBwcm9qZWN0PWNvbnRleHQucHJvamVjdCwKICAgICAgICBtb2RlbF9tb25pdG9yaW5nX2FjY2Vzc19rZXk9b3MuZW52aXJvbi5nZXQoIk1PREVMX01PTklUT1JJTkdfQUNDRVNTX0tFWSIpLAogICAgKQogICAgYmF0Y2hfcHJvY2Vzc29yLnBvc3RfaW5pdCgpCiAgICBiYXRjaF9wcm9jZXNzb3IucnVuKCkKICAgIGlmIGJhdGNoX3Byb2Nlc3Nvci5leGNlcHRpb246CiAgICAgICAgcmFpc2UgYmF0Y2hfcHJvY2Vzc29yLmV4Y2VwdGlvbgo=
    commands: []
    code_origin: https://github.com/katyakats/functions.git#a978cfe997c63413d87fcf796e482f5bd83a4d3f:/Users/katyak/work/functions/model_monitoring_batch/model_monitoring_batch.py
    origin_filename: /Users/katyak/work/functions/model_monitoring_batch/model_monitoring_batch.py
  disable_auto_mount: false
  priority_class_name: ''
  affinity: null
verbose: false
